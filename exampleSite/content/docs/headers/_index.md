---
title: "Custom Headers"
weight: 2
CloudFrontHeaders:
  X-Docs-Section: "headers"
  Cache-Control: "public, max-age=3600"
---

Hedgerules lets you set custom HTTP response headers on any path, using a CloudFront Key Value Store and a viewer-response CloudFront Function.

## How it works

Headers are defined in a `_cfheaders.json` file in your Hugo build output. This file is generated by a Hugo template that merges headers from two sources:

1. **Root headers** from `params.CloudFrontNonPagePathHeaders` in `hugo.toml` (keyed by `/`)
2. **Per-page headers** from `CloudFrontHeaders` in page frontmatter

Hedgerules reads this file and uploads each entry to a CloudFront KVS.

## Header matching

The viewer-response function performs at most two KVS lookups per request:

1. **Exact path** &mdash; looks up the request path (e.g., `/docs/headers/`)
2. **Root `/`** &mdash; looks up the root path as a fallback for global defaults

If both match, exact-path headers take priority. Root headers fill in any headers not set by the exact path.

This covers the two most common use cases:
- **Global security headers** on root `/` apply to every page
- **Per-page overrides** for specific pages that need different headers (e.g., `Cache-Control`)

## Root headers

Define global default headers in `hugo.toml`:

```toml
[params.CloudFrontNonPagePathHeaders]
  [params.CloudFrontNonPagePathHeaders."/"]
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    Referrer-Policy = "strict-origin-when-cross-origin"
```

These are stored in the KVS under the key `/` and applied to every response unless overridden by an exact-path match.

## Per-page headers

Define headers in page frontmatter:

```yaml
---
title: "My Page"
CloudFrontHeaders:
  Cache-Control: "public, max-age=86400"
  X-Custom-Header: "some-value"
---
```

These are stored in the KVS under the page's exact path (e.g., `/docs/my-page/`) and override root headers with the same name.

## Applying the same header to many pages

If you want a header on every page in a section (not just root defaults), use Hugo's [cascade](https://gohugo.io/content-management/front-matter/#cascade) in the section's `_index.md`:

```yaml
---
title: "Blog"
cascade:
  CloudFrontHeaders:
    X-Section: "blog"
---
```

Hugo's template then emits a separate `_cfheaders.json` entry for each page in the section. Let Hugo enumerate the pages &mdash; the CloudFront Function stays simple.

## KVS constraints

CloudFront KVS has size limits:
- Maximum key size: 512 bytes
- Maximum key + value size: 1 KB (1024 bytes)
- Maximum total data size: 5 MB

Hedgerules validates these constraints before uploading and reports errors if any entry exceeds them.
